{% extends "base.html" %}

{% block title %}View Users - Grains Web App{% endblock %}

{% block content %}
<div class="auth-container" style="max-width: 800px;">
    <h2 class="auth-title">Database Users</h2>
    <div class="card mb-4">
        <div class="card-body">
            <table class="table" id="users-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Role</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Users will be dynamically loaded here -->
                </tbody>
            </table>
        </div>
    </div>
    <div class="d-grid gap-2">
        <a href="{{ url_for('dashboard.admin_dashboard') }}" class="btn btn-primary">Back to Dashboard</a>
    </div>
</div>

<script>
    // Fetch the users from the API when the page loads
    fetch('/api/view_users', {
        method: 'GET',
        headers: {
            'Authorization': 'Bearer ' + 'your_jwt_token'  // If you're using JWT for authentication
        }
    })
    .then(response => response.json())
    .then(users => {
        const tbody = document.querySelector('#users-table tbody');
        users.forEach(user => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${user.id}</td>
                <td>${user.username}</td>
                <td><span class="badge ${user.role === 'admin' ? 'bg-danger' : user.role === 'manager' ? 'bg-warning' : 'bg-info'}">${user.role}</span></td>
            `;
            tbody.appendChild(row);
        });
    })
    .catch(error => {
        console.error('Error fetching users:', error);
    });
</script>
{% endblock %}
